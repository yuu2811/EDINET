<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="theme-color" content="#080810">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="EDINET">
    <meta name="format-detection" content="telephone=no">
    <link rel="manifest" href="/static/manifest.json">
    <link rel="apple-touch-icon" href="/static/icon.svg">
    <title>EDINET 大量保有モニター</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- Header -->
    <header id="header">
        <div class="header-left">
            <span class="logo">EDINET</span>
            <span class="logo-sub">大量保有モニター</span>
        </div>
        <div class="header-center">
            <span id="current-time" class="clock"></span>
            <span id="filing-count-badge" class="filing-count-badge" title="本日の提出数">0</span>
            <span id="poll-countdown" class="poll-countdown" title="次回ポーリングまで">--s</span>
        </div>
        <div class="header-right">
            <span id="connection-status" class="connection-status disconnected" aria-live="polite" aria-atomic="true">
                <span class="status-dot disconnected" aria-hidden="true"></span>
                <span class="status-text">DISCONNECTED</span>
            </span>
            <button id="btn-notify" class="btn-icon" title="通知を有効にする" aria-label="デスクトップ通知" aria-pressed="false">&#128276;</button>
            <button id="btn-sound" class="btn-icon active" title="サウンド ON/OFF" aria-label="サウンドアラート: 有効" aria-pressed="true">&#128266;</button>
            <button id="btn-poll" class="btn-icon" title="手動ポーリング" aria-label="手動でEDINETをポーリング">&#8635;</button>
            <button id="btn-stock-view" class="btn-icon" title="株価チャート" aria-label="株価チャートを表示">&#128200;</button>
        </div>
    </header>

    <!-- Ticker -->
    <div id="ticker-bar" role="marquee" aria-label="最新の報告書">
        <div id="ticker-content">
            <span class="ticker-label">LIVE</span>
            <span id="ticker-text">起動中... EDINET APIからデータを取得しています</span>
        </div>
    </div>

    <!-- Main Layout -->
    <div id="main-layout">
        <!-- Left: Live Feed -->
        <div id="feed-panel" class="panel" role="region" aria-label="ライブフィード">
            <div class="panel-header">
                <span class="panel-title">LIVE FEED</span>
                <div class="feed-controls">
                    <label for="feed-search" class="visually-hidden">フィードを検索</label>
                    <input type="text" id="feed-search" placeholder="検索..." class="search-input" aria-label="企業名・証券コードで検索">
                    <label for="feed-filter" class="visually-hidden">報告書タイプ</label>
                    <select id="feed-filter" class="filter-select" aria-label="報告書タイプでフィルター">
                        <option value="all">すべて</option>
                        <option value="new">新規報告のみ</option>
                        <option value="change">変更報告のみ</option>
                        <option value="amendment">訂正のみ</option>
                    </select>
                    <select id="feed-sort" class="filter-select" aria-label="並び替え">
                        <option value="time-desc">新しい順</option>
                        <option value="time-asc">古い順</option>
                        <option value="ratio-desc">保有割合 高→低</option>
                        <option value="ratio-asc">保有割合 低→高</option>
                        <option value="change-desc">変動 大→小</option>
                        <option value="change-asc">変動 小→大</option>
                    </select>
                    <div class="view-toggle">
                        <button id="view-cards" class="view-toggle-btn active" title="カード表示" aria-label="カード表示" aria-pressed="true">&#9776;</button>
                        <button id="view-table" class="view-toggle-btn" title="テーブル表示" aria-label="テーブル表示" aria-pressed="false">&#9638;</button>
                    </div>
                </div>
            </div>
            <div id="date-nav" class="date-nav">
                <button id="date-prev" class="date-nav-btn" title="前日">&#9664;</button>
                <input type="date" id="date-picker" class="date-picker">
                <button id="date-next" class="date-nav-btn" title="翌日">&#9654;</button>
                <button id="date-today" class="date-nav-btn date-today-btn">TODAY</button>
                <button id="date-fetch" class="date-nav-btn date-fetch-btn" title="この日のEDINETデータを取得">FETCH</button>
                <button id="date-export" class="date-nav-btn date-export-btn" title="CSVエクスポート">CSV</button>
            </div>
            <div id="feed-list" class="feed-list" role="feed" aria-label="報告書一覧">
                <div class="feed-empty">
                    <div class="empty-icon">&#128196;</div>
                    <div class="empty-text">報告書が見つかりません</div>
                </div>
            </div>
        </div>

        <!-- Right: Sidebar -->
        <div id="sidebar">
            <!-- Stats Panel -->
            <div id="stats-panel" class="panel" role="region" aria-label="本日の統計">
                <div class="panel-header">
                    <span class="panel-title">TODAY</span>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value" id="stat-total">-</span>
                        <span class="stat-label">提出数</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="stat-new">-</span>
                        <span class="stat-label">新規</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="stat-amendments">-</span>
                        <span class="stat-label">訂正</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="stat-clients">-</span>
                        <span class="stat-label">接続数</span>
                    </div>
                </div>
            </div>

            <!-- Market Summary Panel -->
            <div id="summary-panel" class="panel" role="region" aria-label="マーケットサマリー">
                <div class="panel-header">
                    <span class="panel-title">SUMMARY</span>
                </div>
                <div id="summary-content" class="summary-content">
                    <div class="summary-empty">-</div>
                </div>
            </div>

            <!-- Watchlist Panel -->
            <div id="watchlist-panel" class="panel" role="region" aria-label="ウォッチリスト">
                <div class="panel-header">
                    <span class="panel-title">WATCHLIST</span>
                    <div class="panel-header-actions">
                        <button id="btn-watchlist-stock" class="btn-small" title="株価チャートを表示">&#128200;</button>
                        <button id="btn-add-watch" class="btn-small" title="銘柄を追加" aria-label="ウォッチリストに銘柄を追加">+</button>
                    </div>
                </div>
                <div id="watchlist-form" class="watchlist-form hidden">
                    <label for="watch-name" class="visually-hidden">企業名</label>
                    <input type="text" id="watch-name" placeholder="企業名" class="input-small">
                    <label for="watch-code" class="visually-hidden">証券コード</label>
                    <input type="text" id="watch-code" placeholder="証券コード" class="input-small">
                    <button id="btn-save-watch" class="btn-small btn-accent">追加</button>
                    <button id="btn-cancel-watch" class="btn-small">取消</button>
                </div>
                <div id="watchlist-items" class="watchlist-items">
                    <div class="watchlist-empty">
                        <div class="empty-icon">&#9734;</div>
                        <div class="empty-text">ウォッチリストに企業を追加してください</div>
                    </div>
                </div>
            </div>

            <!-- Top Filers Panel -->
            <div id="top-filers-panel" class="panel" role="region" aria-label="本日の提出者ランキング">
                <div class="panel-header">
                    <span class="panel-title">TOP FILERS</span>
                </div>
                <div id="top-filers-list" class="top-filers-list">
                    <div class="filers-empty">-</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Chart View (dedicated page) -->
    <div id="stock-view" class="stock-view hidden">
        <div class="stock-view-header">
            <div class="stock-search-bar">
                <button id="stock-view-back" class="btn-small" title="フィードに戻る" aria-label="フィードに戻る">&#9664; 戻る</button>
                <label for="stock-search-input" class="visually-hidden">証券コード検索</label>
                <input type="text" id="stock-search-input" placeholder="証券コードを入力 (例: 7203)" class="stock-search-input" maxlength="5" inputmode="numeric">
                <button id="stock-search-btn" class="btn-small btn-accent">検索</button>
            </div>
            <div id="stock-quick-list" class="stock-quick-list">
                <!-- Watchlist items as quick buttons -->
            </div>
        </div>
        <div id="stock-view-body" class="stock-view-body">
            <div class="stock-view-empty">
                <div class="empty-icon">&#128200;</div>
                <div class="empty-text">証券コードを入力して株価チャートを表示</div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detail-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modal-title-text">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title" id="modal-title-text">報告書詳細</span>
                <button class="modal-close" aria-label="閉じる">&times;</button>
            </div>
            <div id="modal-body" class="modal-body"></div>
        </div>
    </div>

    <!-- Confirm Dialog -->
    <div id="confirm-dialog" class="modal hidden" role="alertdialog" aria-modal="true" aria-labelledby="dialog-title">
        <div class="modal-overlay"></div>
        <div class="dialog">
            <div class="dialog-title" id="dialog-title">確認</div>
            <div class="dialog-message" id="dialog-message"></div>
            <div class="dialog-actions">
                <button class="dialog-btn" id="dialog-cancel">キャンセル</button>
                <button class="dialog-btn danger" id="dialog-confirm">削除</button>
            </div>
        </div>
    </div>

    <!-- Mobile Overlay Panels -->
    <div id="mobile-stats-panel" class="sidebar-overlay hidden">
        <div class="overlay-backdrop"></div>
        <div class="overlay-sheet">
            <div class="overlay-handle"></div>
            <div class="overlay-header">
                <span class="panel-title">TODAY'S STATS</span>
                <button class="overlay-close" aria-label="閉じる">&times;</button>
            </div>
            <div class="overlay-body" id="mobile-stats-body">
                <!-- Stats content will be cloned here by JS -->
            </div>
        </div>
    </div>

    <div id="mobile-watchlist-panel" class="sidebar-overlay hidden">
        <div class="overlay-backdrop"></div>
        <div class="overlay-sheet">
            <div class="overlay-handle"></div>
            <div class="overlay-header">
                <span class="panel-title">WATCHLIST</span>
                <button class="overlay-close" aria-label="閉じる">&times;</button>
            </div>
            <div class="overlay-body" id="mobile-watchlist-body">
                <!-- Watchlist content will be cloned here by JS -->
            </div>
        </div>
    </div>

    <div id="mobile-settings-panel" class="sidebar-overlay hidden">
        <div class="overlay-backdrop"></div>
        <div class="overlay-sheet">
            <div class="overlay-handle"></div>
            <div class="overlay-header">
                <span class="panel-title">SETTINGS</span>
                <button class="overlay-close" aria-label="閉じる">&times;</button>
            </div>
            <div class="overlay-body">
                <div class="settings-list">
                    <div class="settings-item">
                        <span class="settings-label">サウンドアラート</span>
                        <button id="mobile-btn-sound" class="settings-toggle active" aria-label="サウンド切替">ON</button>
                    </div>
                    <div class="settings-item">
                        <span class="settings-label">デスクトップ通知</span>
                        <button id="mobile-btn-notify" class="settings-toggle" aria-label="通知切替">OFF</button>
                    </div>
                    <div class="settings-item">
                        <span class="settings-label">手動ポーリング</span>
                        <button id="mobile-btn-poll" class="settings-toggle" aria-label="手動ポーリング">実行</button>
                    </div>
                    <div class="settings-item settings-info">
                        <span class="settings-label">接続状態</span>
                        <span id="mobile-connection-status" class="text-green">LIVE</span>
                    </div>
                    <div class="settings-item settings-info">
                        <span class="settings-label">現在時刻</span>
                        <span id="mobile-clock" class="text-cyan">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav id="mobile-nav" class="mobile-bottom-nav" aria-label="モバイルナビゲーション">
        <button class="nav-item active" data-panel="feed" aria-label="フィード">
            <span class="nav-icon">&#128220;</span>
            <span class="nav-label">フィード</span>
        </button>
        <button class="nav-item" data-panel="stats" aria-label="統計">
            <span class="nav-icon">&#128202;</span>
            <span class="nav-label">統計</span>
        </button>
        <button class="nav-item" data-panel="watchlist" aria-label="ウォッチ">
            <span class="nav-icon">&#9733;</span>
            <span class="nav-label">ウォッチ</span>
        </button>
        <button class="nav-item" data-panel="stock" aria-label="株価">
            <span class="nav-icon">&#128200;</span>
            <span class="nav-label">株価</span>
        </button>
        <button class="nav-item" data-panel="settings" aria-label="設定">
            <span class="nav-icon">&#9881;</span>
            <span class="nav-label">設定</span>
        </button>
    </nav>

    <script src="/static/js/app.js"></script>
</body>
</html>
